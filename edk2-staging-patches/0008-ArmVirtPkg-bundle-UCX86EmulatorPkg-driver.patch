From ad88cbfe6874087cde8918ad9c2f5e92664a397b Mon Sep 17 00:00:00 2001
From: Andrei Warkentin <andrei.warkentin@intel.com>
Date: Fri, 17 Feb 2023 19:00:35 -0600
Subject: [PATCH 8/8] ArmVirtPkg: bundle UCX86EmulatorPkg driver

Similar to RiscVVirt patch.

Signed-off-by: Andrei Warkentin <andrei.warkentin@intel.com>
---
 ArmVirtPkg/ArmVirtQemu.dsc           | 10 ++++++++++
 ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc |  5 +++++
 2 files changed, 15 insertions(+)

diff --git a/ArmVirtPkg/ArmVirtQemu.dsc b/ArmVirtPkg/ArmVirtQemu.dsc
index 72a0cacab4a8..c3c3f53f0c14 100644
--- a/ArmVirtPkg/ArmVirtQemu.dsc
+++ b/ArmVirtPkg/ArmVirtQemu.dsc
@@ -585,3 +585,13 @@ [Components.AARCH64]
     <LibraryClasses>
       NULL|OvmfPkg/Fdt/FdtPciPcdProducerLib/FdtPciPcdProducerLib.inf
   }
+
+  #
+  # X64 emulator for OpRoms, etc.
+  #
+  UCX86EmulatorPkg/Drivers/Emulator/Emulator.inf {
+    <LibraryClasses>
+      UnicornX86Lib|unicorn/efi/UnicornX86Lib.inf
+      UnicornEngineLib|unicorn/efi/UnicornEngineLib.inf
+      UnicornStubLib|unicorn/efi/UnicornStubLib.inf
+  }
diff --git a/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc b/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc
index 8a063bac04ac..b5a1720318a6 100644
--- a/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc
+++ b/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc
@@ -194,3 +194,8 @@ [FV.FvMain]
   # Ramdisk support
   #
   INF MdeModulePkg/Universal/Disk/RamDiskDxe/RamDiskDxe.inf
+
+  #
+  # X64 emulator for OpRoms, etc.
+  #
+  INF UCX86EmulatorPkg/Drivers/Emulator/Emulator.inf
-- 
2.25.1

