From a8589547d436745dd54047c1e337bea2919c2ee8 Mon Sep 17 00:00:00 2001
From: Andrei Warkentin <andrei.warkentin@intel.com>
Date: Tue, 10 Jan 2023 23:49:11 -0600
Subject: [PATCH 6/8] ArmVirtPkg: bundle UCX86EmulatorPkg driver

Similar to RiscVVirt patch.

Signed-off-by: Andrei Warkentin <andrei.warkentin@intel.com>
---
 ArmVirtPkg/ArmVirtQemu.dsc           | 10 ++++++++++
 ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc |  5 +++++
 CryptoPkg/Library/OpensslLib/openssl |  2 +-
 3 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/ArmVirtPkg/ArmVirtQemu.dsc b/ArmVirtPkg/ArmVirtQemu.dsc
index 0390b660c0..86014ea84a 100644
--- a/ArmVirtPkg/ArmVirtQemu.dsc
+++ b/ArmVirtPkg/ArmVirtQemu.dsc
@@ -576,3 +576,13 @@
     <LibraryClasses>
       NULL|OvmfPkg/Fdt/FdtPciPcdProducerLib/FdtPciPcdProducerLib.inf
   }
+
+  #
+  # X64 emulator for OpRoms, etc.
+  #
+  UCX86EmulatorPkg/Drivers/Emulator/Emulator.inf {
+    <LibraryClasses>
+      UnicornX86Lib|unicorn/efi/UnicornX86Lib.inf
+      UnicornEngineLib|unicorn/efi/UnicornEngineLib.inf
+      UnicornStubLib|unicorn/efi/UnicornStubLib.inf
+  }
diff --git a/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc b/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc
index 8a063bac04..b5a1720318 100644
--- a/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc
+++ b/ArmVirtPkg/ArmVirtQemuFvMain.fdf.inc
@@ -194,3 +194,8 @@ READ_LOCK_STATUS   = TRUE
   # Ramdisk support
   #
   INF MdeModulePkg/Universal/Disk/RamDiskDxe/RamDiskDxe.inf
+
+  #
+  # X64 emulator for OpRoms, etc.
+  #
+  INF UCX86EmulatorPkg/Drivers/Emulator/Emulator.inf
diff --git a/CryptoPkg/Library/OpensslLib/openssl b/CryptoPkg/Library/OpensslLib/openssl
index 129058165d..d82e959e62 160000
--- a/CryptoPkg/Library/OpensslLib/openssl
+++ b/CryptoPkg/Library/OpensslLib/openssl
@@ -1 +1 @@
-Subproject commit 129058165d195e43a0ad10111b0c2e29bdf65980
+Subproject commit d82e959e621a3d597f1e0d50ff8c2d8b96915fd7
-- 
2.25.1

